<script src="../wasm-script.js"></script>
<wasm-script id="math" lang="wasp" compiler="../compilers/waspc/compiler.wasm">
     
    extern console_log(message)
    pub fn main(){
        console_log("hello world!")
    }

</wasm-script>
<script>
     // top-level await doesn't exist yet, so we have to do it the lame way
    (async function(){
        debugger;
        const mathModule = await document.getElementById("math").compile({
            console_log: function(message_start) {
                let utf8dec = new TextDecoder("utf-8");
                function fromCString(start) {
                    const data = new Uint8Array(mathModule.memory.buffer);
                    const str = [];
                    let i = start;
                    while (data[i] !== 0) {
                    str.push(data[i]);
                    i++;
                    }
                    return utf8dec.decode(new Uint8Array(str));
                }
                let _message = fromCString(message_start);
                document.body.innerHTML += _message;
              }
        });
        mathModule.main();
    })();
</script>